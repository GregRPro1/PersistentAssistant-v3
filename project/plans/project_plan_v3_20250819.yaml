phases:
  - name: "Phase 0: Foundation Setup"
    steps:
      - id: "0.1"
        status: done
        description: 'Define root project directory layout (C:\_Repos\PersistentAssistant)'
        items:
          - title: "Confirm base folders created"
            status: done
          - title: "Confirm Windows + VSCode env"
            status: done
      - id: "0.2"
        status: done
        description: "Initialize new Git repository and first commit"
        items:
          - title: ".gitignore and README present"
            status: done
      - id: "0.3"
        status: done
        description: "Create venv, requirements, and lock PyQt6 environment"
        items:
          - title: "PyQt6 + PyQt6-WebEngine installed"
            status: done

  - name: "Phase 1: MVP Interface Foundations"
    steps:
      - id: "1.1"
        status: done
        description: "Create main.py with minimal startup logic"
        items:
          - title: "App boots"
            status: done
      - id: "1.2"
        status: done
        description: "Create main_window.py with tabbed layout"
        items:
          - title: "Tabs mount without errors"
            status: done
      - id: "1.3"
        status: done
        description: "Create input_tab.py with editable text + copy button"
        items:
          - title: "Copy to clipboard works"
            status: done
      - id: "1.4"
        status: done
        description: "Create prompt_tab.py with editable prompt + copy button"
        items:
          - title: "Copy to clipboard works"
            status: done
      - id: "1.5"
        status: done
        description: "Create chat_tab.py with embedded ChatGPT browser pane"
        items:
          - title: "Loads chat.openai.com (manual login)"
            status: done
      - id: "1.6"
        status: done
        description: "Create response_tab.py with paste + log"
        items:
          - title: "Paste from clipboard works"
            status: done
          - title: "Manual log to YAML works"
            status: done
      - id: "1.7"
        status: done
        description: "Implement autosave on paste to YAML"
        items:
          - title: "Auto-write to data/interactions/"
            status: done
      - id: "1.8"
        status: done
        description: "Add visual confirmation (status label) for saves/copies"
        items:
          - title: "Timed status messages visible"
            status: done
      - id: "1.9"
        status: done
        description: "Enforce file headers and docstrings"
        items:
          - title: "Headers present in all GUI/core files"
            status: done
      - id: "1.10"
        status: done
        description: "Create core/prompt_formatter.py and hook Format button"
        items:
          - title: "Minimal structured prompt wrapper"
            status: done
      - id: "1.11"
        status: done
        description: "Simulate AI send (Prompt → Response)"
        items:
          - title: "Dummy response writer working"
            status: done
      - id: "1.12"
        status: done
        description: "Copy All as YAML (Input+Prompt+Response)"
        items:
          - title: "Writes combined YAML and copies to clipboard"
            status: done
      - id: "1.13"
        status: done
        description: "Plan tab (read-only) loads plan YAML and shows current"
        items:
          - title: "Show phases/steps with statuses"
            status: done
          - title: "Show progress string (Phase/Step/Items)"
            status: done
      - id: "1.14"
        status: done
        description: "Plan controls (Advance / Rollback)"
        items:
          - title: "Update plan YAML in place"
            status: done
          - title: "Immediate UI refresh"
            status: done
      - id: "1.15"
        status: done
        description: "Structure Runner (launch tools/structure_sync.py from UI)"
        items:
          - title: "Show file counts and link to snapshot"
            status: done
      - id: "1.16"
        status: done
        description: "Self-Introspection v1 (write insights report from snapshot)"
        items:
          - title: "data/insights/introspection_report.yaml"
            status: done
      - id: "1.17"
        status: done
        description: "Self-Development Loop v1 (open improvement tasks)"
        items:
          - title: "data/tickets/task_*.yaml (created via UI)"
            status: done

  - name: "Phase 2: Project Context + Selection"
    steps:
      - id: "2.1"
        status: done
        description: "Project selector at startup (multi-project support)"
        items:
          - title: "Persist last project choice"
            status: done
      - id: "2.2"
        status: done
        description: "Load project metadata (paths, plan path) from simple YAML"
        items:
          - title: "Show project name/path in status bar"
            status: done
      - id: "2.3"
        status: done
        description: "Project switching entry point (menu)"
        items:
          - title: "Project → Switch… menu opens selector and persists session"
            status: done
      - id: "2.4"
        status: planned
        description: "File-integrity protocol (manifest + safe replace + drift verify)"
        items:
          - title: "tools/file_manifest.py → project/structure/file_manifest.yaml"
            status: planned
          - title: "tools/safe_replace.py gated by expected sha256"
            status: planned
          - title: "tools/verify_against_manifest.py drift checker"
            status: planned

  - name: "Phase 3: Model Catalogue & Providers"
    steps:
      - id: "3.1"
        status: done
        description: "Keys loader + sanity checks"
        items:
          - title: "tools/_env.py + tools/check_api_keys.py"
            status: done
      - id: "3.2"
        status: done
        description: "Fetch raw provider models"
        items:
          - title: "tools/fetch_ai_models.py → ai_models_raw.yaml"
            status: done
      - id: "3.3"
        status: done
        description: "Schema validator with JSON SUMMARY"
        items:
          - title: "tools/check_ai_models.py validates ai_models.yaml"
            status: done
      - id: "3.4"
        status: done
        description: "Provider docs + curated pricing/caps (override/scrape/baseline)"
        items:
          - title: "tools/provider_docs.py produces curated dynamic entries"
            status: done
      - id: "3.5"
        status: done
        description: "Update & promote models safely"
        items:
          - title: "tools/update_ai_models.py → ai_models_tmp.yaml → ai_models.yaml"
            status: done
      - id: "3.6"
        status: done
        description: "Probe models (ping) and mark health"
        items:
          - title: "tools/probe_models.py → data/insights/probe_report.json"
            status: done
      - id: "3.7"
        status: done
        description: "GUI tools tab: busy cursor, per-run logs, summaries"
        items:
          - title: "Update/Probe/Check Keys buttons wired"
            status: done
          - title: "Per-run logs logs/tool_run_*.log"
            status: done
      - id: "3.8"
        status: planned
        description: "Optional pricing overrides file"
        items:
          - title: "config/provider_pricing_overrides.yaml supported"
            status: planned

  - name: "Phase 4: OpenAI-first API Send Path"
    steps:
      - id: "4.1"
        status: in_progress
        description: "Model & Mode UI (OpenAI-only now): provider lock, model dropdown from ai_models.yaml, Browser/API toggle"
        items:
          - title: "Filter to chat-capable & healthy models"
            status: planned
          - title: "Persist selection in project_session.yaml"
            status: planned
      - id: "4.2"
        status: planned
        description: "Wire ai_client to 'Send to AI (API)' button"
        items:
          - title: "Reply → Response tab; errors → Tools status/log"
            status: planned
          - title: "OpenAI-only gate via UI toggle"
            status: planned
      - id: "4.3"
        status: planned
        description: "Auto-log token usage and cost to interaction YAML"
        items:
          - title: "Append provider/model/tokens/cost"
            status: planned
      - id: "4.4"
        status: planned
        description: "Robust error surfacing (keys/quota/4xx/5xx) with succinct user summary"
        items:
          - title: "One-line UI summary + detailed log file"
            status: planned
      - id: "4.5"
        status: planned
        description: "Unit tests for ai_client pricing and selection"
        items:
          - title: "tests/test_ai_client_costs.py"
            status: planned

  - name: "Phase 5: Memory & Persistence"
    steps:
      - id: "5.1"
        status: planned
        description: "Persistent memory (summarize interactions → memory store)"
        items:
          - title: "memory/summary_*.yaml"
            status: planned
      - id: "5.2"
        status: planned
        description: "Retrieve memory into prompt_formatter context window"
        items:
          - title: "Configurable include rules"
            status: planned
      - id: "5.3"
        status: planned
        description: "Memory viewer in Plan tab (read-only first)"
        items:
          - title: "List & open summaries"
            status: planned

meta:
  version: "3.1"
  current_step_policy: "explicit"
  current_step: "4.1"
